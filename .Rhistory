per.figura[per.figura$Var1 == 'NewZealand',]$Var1 = 'New Zealand'
per.figura[per.figura$Var1 == 'UnitedArabEmirates',]$Var1 = 'United Arab Emirates'
per.figura[per.figura$Var1 == 'HongKong',]$Var1 = 'Hong Kong'
per.figura[per.figura$Var1 == 'DemocraticRepublicoftheCongo',]$Var1 = 'Democratic Republic of the Congo'
per.figura[per.figura$Var1 == 'CzechRepublic',]$Var1 = 'Czech Republic'
per.figura[per.figura$Var1 == 'NorthMacedonia',]$Var1 = 'North Macedonia'
per.figura[per.figura$Var1 == 'BosniaandHerzegovina',]$Var1 = 'Bosnia and Herzegovina'
per.figura[per.figura$Var1 == 'SierraLeone',]$Var1 = 'Sierra Leone'
per.figura[per.figura$Var1 == 'DominicanRepublic',]$Var1 = 'Dominican Republic'
# per.figura[per.figura$Var1 == '',]$Var1 = ''
p<- ggplot(data = per.figura, aes(x=reorder(Var1, Freq), y=Freq)) +
geom_bar(stat = 'identity') + coord_flip() + theme_minimal() + ylab("# of Genomes") + xlab("Country/Region")
ggsave(filename= 'output/Figures/all.countries.genome.freq.png', plot=p, width=30, height=30, units = "cm", dpi = 300)
sum(is.na(metadata$Country))
countries = table(metadata$Country)
countries = countries[countries>25] # 64
range(countries) # 27 14844
sel.countries = names(countries)
bin <- 7 # used for aggregating the data and aligning the labels
metadata = metadata[metadata$Country %in% sel.countries,]
p = ggplot(metadata, aes(Collection.date, ..count..))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.original.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.metadata = read.csv('output/25.JK.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.metadata$Collection.date = as.Date(t.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.metadata, aes(Collection.date, ..count..))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.t.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.n.metadata = read.csv('output/25.JK.no.time.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.n.metadata$Collection.date = as.Date(t.n.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.n.metadata, aes(Collection.date, ..count..))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.only..png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) +
scale_x_date(limits = lims)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) +
scale_x_date(limits = lims) +
scale_y_continuous(breaks=seq(0, 2, 2))
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) +
scale_x_date(limits = lims) +
scale_y_continuous(breaks=seq(0, 2, 2))
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
metadata = metadata[metadata$Country %in% sel.countries,]
p = ggplot(metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.original.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.metadata = read.csv('output/25.JK.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.metadata$Collection.date = as.Date(t.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.t.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.n.metadata = read.csv('output/25.JK.no.time.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.n.metadata$Collection.date = as.Date(t.n.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.n.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.only..png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
rm(list=ls())
#
# if (!requireNamespace("BiocManager", quietly = TRUE))
#   install.packages("BiocManager")
#
# BiocManager::install("DECIPHER")
library(stringr)
library(DECIPHER)
library(dplyr)
library(ggplot2)
library("scales")
library(gridExtra)
# setwd('/blue/salemi/simone.marini/codiv19/GA_case_study')
setwd('/home/dottornomade/Dropbox/Scienza/CoViD2019/national_spread/tardis/')
# ALL
metadata = read.csv('data/msa_0915/no.50.Ns.filtered.msa_0915.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
check = c('EPI_ISL_529036', 'EPI_ISL_529035', 'EPI_ISL_525428', 'EPI_ISL_525426')
metadata = metadata[!metadata$Accession.ID %in% check,]
metadata$Collection.date = as.Date(metadata$Collection.date, format = "%m/%d/%y")
genomes = readDNAStringSet('data/msa_0915/aln.fa')
genomes = genomes[names(genomes) %in% metadata$Accession.ID]
all(names(genomes) == metadata$Accession.ID) # ordince corretto
per.figura <- data.frame(table(metadata$Country), stringsAsFactors = FALSE)
per.figura = per.figura %>% arrange(desc(Freq))
per.figura$Var1 = as.character(per.figura$Var1)
per.figura[per.figura$Var1 == 'UnitedKingdom',]$Var1 = 'United Kingdom'
per.figura[per.figura$Var1 == 'SouthAfrica',]$Var1 = 'South Africa'
per.figura[per.figura$Var1 == 'SaudiArabia',]$Var1 = 'Saudi Arabia'
per.figura[per.figura$Var1 == 'SouthKorea',]$Var1 = 'South Korea'
per.figura[per.figura$Var1 == 'NewZealand',]$Var1 = 'New Zealand'
per.figura[per.figura$Var1 == 'UnitedArabEmirates',]$Var1 = 'United Arab Emirates'
per.figura[per.figura$Var1 == 'HongKong',]$Var1 = 'Hong Kong'
per.figura[per.figura$Var1 == 'DemocraticRepublicoftheCongo',]$Var1 = 'Democratic Republic of the Congo'
per.figura[per.figura$Var1 == 'CzechRepublic',]$Var1 = 'Czech Republic'
per.figura[per.figura$Var1 == 'NorthMacedonia',]$Var1 = 'North Macedonia'
per.figura[per.figura$Var1 == 'BosniaandHerzegovina',]$Var1 = 'Bosnia and Herzegovina'
per.figura[per.figura$Var1 == 'SierraLeone',]$Var1 = 'Sierra Leone'
per.figura[per.figura$Var1 == 'DominicanRepublic',]$Var1 = 'Dominican Republic'
# per.figura[per.figura$Var1 == '',]$Var1 = ''
p<- ggplot(data = per.figura, aes(x=reorder(Var1, Freq), y=Freq)) +
geom_bar(stat = 'identity') + coord_flip() + theme_minimal() + ylab("# of Genomes") + xlab("Country/Region")
ggsave(filename= 'output/Figures/all.countries.genome.freq.png', plot=p, width=30, height=30, units = "cm", dpi = 300)
sum(is.na(metadata$Country))
countries = table(metadata$Country)
countries = countries[countries>25] # 64
range(countries) # 27 14844
sel.countries = names(countries)
bin <- 7 # used for aggregating the data and aligning the labels
metadata = metadata[metadata$Country %in% sel.countries,]
p = ggplot(metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.original.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.metadata = read.csv('output/25.JK.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.metadata$Collection.date = as.Date(t.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.t.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.n.metadata = read.csv('output/25.JK.no.time.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.n.metadata$Collection.date = as.Date(t.n.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.n.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.only.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
metadata = metadata[metadata$Country %in% sel.countries,]
p = ggplot(metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.1 <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.original.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.metadata = read.csv('output/25.JK.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.metadata$Collection.date = as.Date(t.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.2 <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.t.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.n.metadata = read.csv('output/25.JK.no.time.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.n.metadata$Collection.date = as.Date(t.n.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.n.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.3 <- p + theme_bw() + xlab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.only.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.2, p.3) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
metadata = metadata[metadata$Country %in% sel.countries,]
p = ggplot(metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.1 <- p + theme_bw() + xlab(NULL) + ylab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.original.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.metadata = read.csv('output/25.JK.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.metadata$Collection.date = as.Date(t.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.2 <- p + theme_bw() + xlab(NULL) + ylab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.t.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.n.metadata = read.csv('output/25.JK.no.time.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.n.metadata$Collection.date = as.Date(t.n.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.n.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.3 <- p + theme_bw() + xlab(NULL) + ylab(NULL)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.only.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.2, p.3) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
metadata = metadata[metadata$Country %in% sel.countries,]
p = ggplot(metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.1 <- p + theme_bw() + xlab(NULL) + ylab('all genomes, 51892')
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.original.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.metadata = read.csv('output/25.JK.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.metadata$Collection.date = as.Date(t.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.2 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t + g, 1600')
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.t.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
t.n.metadata = read.csv('output/25.JK.no.time.max/metadata.rep.JK.1.max.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
t.n.metadata$Collection.date = as.Date(t.n.metadata$Collection.date, format = "%Y-%m-%d")
p = ggplot(t.n.metadata, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(binwidth = bin, colour="white")
p.3 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t, 1600')
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.d.only.png'), plot=p, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/all.countries.temporal.dist.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) +
scale_y_continuous(breaks=seq(0, 2, 2))
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) +
scale_y_continuous(breaks=seq(0, 2, 2))
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) +
scale_y_continuous(breaks=seq(0, 2, 2))
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) +
scale_y_continuous(breaks=seq(0, 2, 2))
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) +
scale_y_continuous(breaks=seq(0, 2, 2))
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) +
scale_y_continuous(breaks=seq(0, 2, 2))
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
sel.country = 'USA'
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
scaleFUN <- function(x) sprintf("%.2f", x)
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count..))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab(NULL) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(paste('original', dim(tmp.meta)[1])) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(paste('all genomes.', dim(tmp.meta)[1])) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t + g, 25') +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t + g, 25') +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(paste('all genomes,', dim(tmp.meta)[1])) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t + g, 25') +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t + g, 25') +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(paste('all genomes,', dim(tmp.meta)[1])) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN) + ggtitle(sel.country)
p
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(paste('all genomes,', dim(tmp.meta)[1])) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t + g, 25') +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t + g, 25') +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
for (sel.country in sel.countries){
tmp.meta = metadata[metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
lims = c(as.Date(min(tmp.meta$Collection.date)),as.Date(max(tmp.meta$Collection.date)))
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.1 <- p + theme_bw() + xlab(NULL) + ylab(paste('all genomes,', dim(tmp.meta)[1])) +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.dist.original.png'), plot=p.1, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.metadata[t.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.2 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t + d, 25') +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.max.png'), plot=p.2, width=25, height=5, units = "cm", dpi = 300)
tmp.meta = t.n.metadata[t.n.metadata$Country == sel.country,]
tmp.meta$num <- as.numeric(tmp.meta$Collection.date)
p = ggplot(tmp.meta, aes(Collection.date, ..count../sum(..count..)))
p <- p + geom_histogram(colour="white", binwidth = 5)
p.3 <- p + theme_bw() + xlab(NULL) + ylab('subsampled, t, 25') +
scale_x_date(limits = lims) + scale_y_continuous(labels=scaleFUN)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.no.time.max.png'), plot=p.3, width=25, height=5, units = "cm", dpi = 300)
ggsave(filename= paste0('output/Figures/', sel.country, '.hist.temporal.25K.all.png'), plot=do.call("grid.arrange", c(list(p.1, p.3, p.2) ,ncol = 1)), width=25, height=15, units = "cm", dpi = 100)
}
rm(list=ls())
#
# if (!requireNamespace("BiocManager", quietly = TRUE))
#   install.packages("BiocManager")
#
# BiocManager::install("DECIPHER")
library(stringr)
library(DECIPHER)
library(dplyr)
# setwd('/blue/salemi/simone.marini/codiv19/GA_case_study')
setwd('/home/dottornomade/github/tardis-phylogenetics/')
metadata = read.csv('data/msa_0915/no.50.Ns.filtered.msa_0915.csv', header = TRUE, sep = ',', stringsAsFactors = FALSE) #
check = c('EPI_ISL_529036', 'EPI_ISL_529035', 'EPI_ISL_525428', 'EPI_ISL_525426')
metadata = metadata[!metadata$Accession.ID %in% check,]
metadata$Collection.date = as.Date(metadata$Collection.date, format = "%m/%d/%y")
genomes = readDNAStringSet('data/msa_0915/aln.fa')
genomes = genomes[names(genomes) %in% metadata$Accession.ID]
all(names(genomes) == metadata$Accession.ID) # ordince corretto
